global
    maxconn 4096
    node lb1
    spread-checks 5

defaults
    log     global
    mode    http
    # option  httplog
    option  dontlognull
    retries 3
    option redispatch
    maxconn 2000
    contimeout      5000
    clitimeout      50000
    srvtimeout      50000

frontend ft_global
    bind *:9090
    mode http
    acl backend_host_debug_1 req.hdr(Host) localhost
    acl backend_path_debug_2 path_reg ^/owncloud2$|^/owncloud2/
    use_backend backend_debug_3 if backend_host_debug_1 backend_path_debug_2
    acl backend_host_debug_5 req.hdr(Host) localhost
    acl backend_path_debug_6 path_reg ^/owncloud$|^/owncloud/
    use_backend backend_debug_7 if backend_host_debug_5 backend_path_debug_6
backend backend_debug_3
    reqirep  ^([^\ :]*)\ /owncloud2/(.*)     \1\ /\2
    rspirep ^(Location:)\ http://([^/]*)/(.*)$    \1\ /owncloud2/\3
    server debug_4 localhost:8081
backend backend_debug_7
    reqirep  ^([^\ :]*)\ /owncloud/(.*)     \1\ /owncloud/\2
    rspirep ^(Location:)\ http://([^/]*)/owncloud/(.*)$    \1\ /owncloud/\3
    server debug_8 localhost:8080
